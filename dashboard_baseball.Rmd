---
title: "Dashboard-baseball"
output: flexdashboard::flex_dashboard
runtime: shiny
date: "2025-10-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(flexdashboard)
library(shiny)
library(DT)
library(dplyr)
library(ggplot2)
library(plotly)
library(ggimage)
library(readr)

stats <- read.csv("data/stats_joueurs.csv", header=TRUE)
stats <- stats %>%
  select(
    last_name..first_name,
    pa,
    k_percent,
    bb_percent,
    on_base_plus_slg,
    b_gnd_into_dp,
    b_hit_ground,
    b_hit_fly,
    b_out_fly,
    b_out_ground,
    b_out_line_drive,
    b_out_popup,
    b_swinging_strike,
    fast_swing_rate,
    sweet_spot_percent,
    barrel_batted_rate,
    hard_hit_percent,
    avg_best_speed,
    avg_hyper_speed,
    whiff_percent,
    swing_percent
  ) %>%
  rename(
    nom_joueur = last_name..first_name,
    presences_au_baton = pa,
    pourcent_retraits_baton = k_percent,
    pourcent_buts_sur_balles = bb_percent,
    OPS = on_base_plus_slg,
    double_jeu = b_gnd_into_dp,
    coups_sur_sol = b_hit_ground,
    coups_en_fleche = b_hit_fly,
    retraits_en_fleche = b_out_fly,
    retraits_au_sol = b_out_ground,
    retraits_ligne = b_out_line_drive,
    retraits_popup = b_out_popup,
    retraits_elan_manque = b_swinging_strike,
    taux_swings_rapides = fast_swing_rate,
    pourcent_sweet_spot = sweet_spot_percent,
    taux_frappe_puissante = barrel_batted_rate,
    pourcent_frappe_forte = hard_hit_percent,
    vitesse_moy_frappe = avg_best_speed,
    vitesse_moy_frappe_puissante = avg_hyper_speed,
    pourcent_elans_manques = whiff_percent,
    pourcent_elans_total = swing_percent
  )
```

# onglet1

## Résumé général


```{r, echo=FALSE, results='asis'}
library(htmltools)


# Légende
tags$div(
  style = "margin-bottom: 10px;",
  tags$span("⬤ ", style = "color:#2ECC71;"), "Top 10% (meilleures performances) ",
  tags$span("⬤ ", style = "color:#E74C3C; margin-left: 20px;"), "Bottom 10% (pires performances)"
)

# Tableau
datatable(
  stats,
  extensions = 'Buttons',
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    pageLength = 15,
    lengthMenu = c(10, 15, 25, 50, 100),
    scrollX = TRUE,
    scrollY = '500px',
    autoWidth = TRUE,
    searchHighlight = TRUE
  ),
  filter = "top",
  rownames = FALSE,
  caption = "Statistiques des frappeurs MLB (Saison 2024–2025)"
) %>%
  formatStyle('OPS',
    backgroundColor = styleInterval(c(0.54, 0.83), c('#E74C3C', '', '#2ECC71'))
  ) %>%
  formatStyle('pourcent_frappe_forte',
    backgroundColor = styleInterval(c(29.36, 49.84), c('#E74C3C', '', '#2ECC71'))
  ) %>%
  formatStyle('taux_frappe_puissante',
    backgroundColor = styleInterval(c(2.40, 14.00), c('#E74C3C', '', '#2ECC71'))
  ) %>%
  formatStyle('pourcent_sweet_spot',
    backgroundColor = styleInterval(c(26.86, 39.00), c('#E74C3C', '', '#2ECC71'))
  ) %>%
  formatStyle('vitesse_moy_frappe',
    backgroundColor = styleInterval(c(96.77, 102.95), c('#E74C3C', '', '#2ECC71'))
  ) %>%
  formatStyle('vitesse_moy_frappe_puissante',
    backgroundColor = styleInterval(c(92.43, 96.03), c('#E74C3C', '', '#2ECC71'))
  ) %>%
  formatStyle('pourcent_elans_manques',
    backgroundColor = styleInterval(c(17.90, 34.48), c('#2ECC71', '', '#E74C3C'))
  )

```





# Onglet2


>>>>>>> c2b25a412ac0d1b6a8d396ea037b89b655d0f2ff

## titre

```{r, echo=FALSE}
selectizeInput("Joueur", "Selectionne deux joueurs:", choices= sort(unique(stats$nom_joueur)), multiple=TRUE)


renderDataTable({
  datatable(
  subset(stats, last_name..first_name %in% input$Joueur),
  filter ="top",
  options = list(scrollX=TRUE, autoWidth = TRUE, dom='Brtip', buttons = c('colvis'), 
    columnDefs = list(list(visible = TRUE, targets = 0:6),list(visible = FALSE, targets = 7:22)) ),
  extensions = "Buttons"
  
  )})


renderPlotly({
  stats_graph <- subset(stats, last_name..first_name %in% input$Joueur)
  
  ggplotly(
    ggplot(stats_graph, aes(
      x= fast_swing_rate,
      y= hard_hit_percent,
      color= last_name..first_name)
            )
    +
    
      geom_line(linewidth=1) + geom_point(size=3) 
    +
      labs(title="", x="", y="",color = "Joueur")
    +
      theme_minimal()
      
  )
  
})





```


#Onglet 3

## Statistiques par équipe

```{r, echo=FALSE}

# Charger les données des équipes
Dodgers <- read_csv("data/Dodgers.csv")
Red_Soxs <- read_csv("data/Red Soxs.csv")
Cubs <- read_csv("data/Cubs.csv")
Yankees <- read_csv("data/Yankees.csv")

# Ajouter la colonne d'équipe
stats_1 <- stats %>%
  mutate(equipe = case_when(
    nom_joueur %in% Yankees$player_name ~ "Yankees",
    nom_joueur %in% Cubs$player_name ~ "Cubs",
    nom_joueur %in% Dodgers$player_name ~ "Dodgers",
    nom_joueur %in% Red_Soxs$player_name ~ "Red_Soxs",
    TRUE ~ NA_character_
  ))

# Calculer les moyennes par équipe
stats_equipes <- stats_1 %>%
  group_by(equipe) %>%
  summarise(
    presences_totales = sum(presences_au_baton, na.rm = TRUE),
    OPS_moyen = mean(OPS, na.rm = TRUE),
    taux_frappe_puissante_moyen = mean(taux_frappe_puissante, na.rm = TRUE),
    pourcent_frappe_forte_moyen = mean(pourcent_frappe_forte, na.rm = TRUE),
    vitesse_moy_frappe_moyenne = mean(vitesse_moy_frappe, na.rm = TRUE)
  ) %>%
  filter(!is.na(equipe))

# ✅ Dictionnaire original des logos
logos_equipes <- tibble::tibble(
  equipe = c("Yankees", "Cubs", "Red_Soxs", "Dodgers"),
  logo = c(
    "extra/ChatGPT Image 8 oct. 2025, 11_57_03.png",  # Yankees
    "extra/ChatGPT Image 8 oct. 2025, 12_15_07.png",  # Cubs
    "extra/ChatGPT Image 8 oct. 2025, 12_20_09.png",  # Dodgers
    "extra/ChatGPT Image 8 oct. 2025, 12_25_51.png"   # Red Soxs
  )
)

stats_equipes <- left_join(stats_equipes, logos_equipes, by = "equipe")

stats_equipes <- stats_1 %>%
  group_by(equipe) %>%
  summarise(
    presences_totales = sum(presences_au_baton, na.rm = TRUE),
    OPS_moyen = mean(OPS, na.rm = TRUE),
    pourcent_buts_sur_balles_moyen = mean(pourcent_buts_sur_balles, na.rm = TRUE),
    pourcent_retraits_baton_moyen = mean(pourcent_retraits_baton, na.rm = TRUE),
    taux_frappe_puissante_moyen = mean(taux_frappe_puissante, na.rm = TRUE),
    pourcent_frappe_forte_moyen = mean(pourcent_frappe_forte, na.rm = TRUE),
    vitesse_moy_frappe_moyenne = mean(vitesse_moy_frappe, na.rm = TRUE)
  ) %>%
  left_join(logos_equipes, by = "equipe")




```

# Onglet 3

## Statistiques par équipe

### Choix de statistique
```{r, echo=FALSE}


library(ggplot2)
library(ggimage)
library(dplyr)

# Choix de la catégorie
selectInput("categorie", "Choisir une catégorie :", choices = c("Puissance", "Discipline", "Vitesse"))

# Préparer les données pour le graphique
stats_plot <- reactive({
  if (input$categorie == "Puissance") {
    stats_equipes %>% mutate(valeur = taux_frappe_puissante_moyen)
  } else if (input$categorie == "Discipline") {
    stats_equipes %>% mutate(valeur = pourcent_buts_sur_balles_moyen)
  } else {
    stats_equipes %>% mutate(valeur = vitesse_moy_frappe_moyenne)
  }
})

# Affichage du graphique avec logos sur les barres
renderPlot({
  ggplot(stats_plot(), aes(x = equipe, y = valeur)) +
    geom_col(fill = "lightblue") +
    geom_image(aes(image = logo), size = 0.08, by = "height") +
    labs(title = paste("Statistique :", input$categorie),
         x = "Équipe", y = "Valeur") +
    theme_minimal()
})

```



